(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"+GB8":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/inline");class n extends o{}n.blotName="subscript",n.tagName="SUB",r.default.register("formats/subscript",n);var i=n;e.default=i,t.exports=e.default},"+IiC":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.loadAlphabetizedLinkSets=function(){return o().then(t=>r(t))},e.loadLinkSets=o;var a=s("kh36"),r=s("gmFb");function o(){return a("/api/chorus/link_sets",{query:{per_page:1e4,community_id:app.state.get("doc","community_id")},opts:{cache:!0}}).then((function(t){return t._embedded.link_set}))}},"/+VR":function(t,e,s){"use strict";const a=s("tNa1").Delta,r=[""," ","\n","{","[","(","<"],o=r.concat(["‘"]),n=r.concat(["“"]);t.exports=function(t){let e=new a;for(let[s,a]of t.ops.entries()){if("string"!=typeof a.insert){e.push(a);continue}let r="";if(s>0){let e=t.ops[s-1];r="string"==typeof e.insert?e.insert[e.insert.length-1]:""}let i="";for(let[t,e]of a.insert.split("").entries()){let s=0===t?r:i[t-1];'"'===e?e=o.includes(s)?"“":"”":"'"===e&&(e=n.includes(s)?"‘":"’"),i+=e}e.insert(i,a.attributes)}return e}},"/LyM":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,s("Kz25");var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a},o=s("LvDl");const n=r.default.import("blots/inline"),i=["http:","https:","mailto:","tel:"];class l extends n{static create(t){let e=super.create(t);return e.dataset.autolinkId=t.id,e.dataset.autolinkHref=function(t){try{return i.includes(new URL(t).protocol)?t:"about:blank"}catch(t){return"about:blank"}}(t.href),t.disabled&&(e.dataset.autolinkDisabled=""),e}static formats(t){return{id:t.dataset.autolinkId,href:t.dataset.autolinkHref,disabled:t.hasAttribute("data-autolink-disabled")}}optimize(t){super.optimize(t);let e=this.next;e instanceof l&&e.prev===this&&(0,o.isEqual)(this.formats(),e.formats())&&(e.moveChildren(this),e.remove())}}n.order.splice(n.order.indexOf("link"),0,"autolink"),l.blotName="autolink",l.tagName="A",l.className="ql-autolink",r.default.register("formats/autolink",l);var u=l;e.default=u,t.exports=e.default},"/p+M":function(t,e,s){"use strict";const a=["scorecard"];t.exports=function(t){return t.every(t=>t.hasOwnProperty("image"))||a.some(e=>t.every(t=>t.hasOwnProperty("doc")&&e===t.doc.type))}},"0PCY":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.addStreamMember=async function(t,e){if(app.state.get(["doc","id"])===e){let s=app.state.get(["doc","head","contents","streams"]),a=[];s?a.push({p:["streams",s.length],li:{id:t}}):a.push({p:["streams"],oi:[{id:t}]}),p.localUpdate(e,a)}else{let s=(await f.getDoc(e)).head.contents.streams,a=[];s?a.push({p:["streams",s.length],li:{id:t}}):a.push({p:["streams"],oi:[{id:t}]}),f.updateDoc(e,{delta:a})}},e.getMemberByUrl=async function(t){const e={q:t,community_id:app.state.get(["community","id"]),schema_name:"story",archived:!1,trashed:!1},{docs:s}=await f.searchDocs(e),a=new Set(app.state.get(["stream","docs"]).map(t=>t.id)),r=s[0];return r&&a.has(r.id)?[{value:null,text:"Story already in stream"}]:r?v(r.head.contents)||_(r.head.contents)?[{value:null,text:b}]:[y(r)]:[{value:null,text:"No results found"}]},e.getStreamsForMember=async function(){let t=app.state.get(["doc","head","contents","streams"]);if(!t||0===t.length)return[];let e=t.map(t=>t.id).join(",");const{docs:s}=await f.searchDocs({ids:e});return s.map(t=>({doc_id:t.id,title:t.title}))},e.memberAdded=function(t){let e=app.state.get(["stream","docs"]).slice();e.push(t),e=r(e,[o("doc.updated_at"),o("doc.title")],["desc","asc"]),app.state.set(["stream","docs"],e);const s=app.state.get(["stream","pagination","total"])||0;app.state.set(["stream","pagination","total"],s+1),M("added",t)},e.memberRemoved=function(t){let e=app.state.get(["stream","docs"]).slice().filter(e=>e.id!==t.id);app.state.set(["stream","docs"],e);const s=app.state.get(["stream","pagination","total"])||0;s>0&&app.state.set(["stream","pagination","total"],s-1),M("removed",t)},e.removeStreamMember=async function(t,e){if(app.state.get(["doc","id"])===e){let s=app.state.get(["doc","head","contents","streams"]);if(s){let a=s.findIndex(e=>e.id===t);-1!==a&&p.localUpdate(e,[{p:["streams",a],ld:{id:t}}])}}else{let s=(await f.getDoc(e)).head.contents.streams;if(s){let a=s.findIndex(e=>e.id===t);-1!==a&&f.updateDoc(e,{delta:[{p:["streams",a],ld:{id:t}}]})}}},e.searchMembers=async function(t){let e={q:t,community_id:app.state.get(["community","id"]),schema_name:"story",order:"date",story_type_blocklist:["stream","link"],archived:!1,trashed:!1},{docs:s}=await f.searchDocs(e),a=new Set(app.state.get(["stream","docs"]).map(t=>t.id));if(1===s.length&&a.has(s[0].id))return[{value:null,text:"Story already in stream"}];s=s.filter(t=>!a.has(t.id));let r=s.map(e=>y(e,t));if(0===r.length)return[{value:null,text:"No results found"}];return r},e.searchStreams=async function(t,e){let s={q:t+" type:stream",community_id:app.state.get(["community","id"]),schema_name:"story",per_page:5,archived:!1,trashed:!1},{docs:a}=await f.searchDocs(s),r=new Set(e.map(t=>t.doc_id));a=a.filter(t=>!r.has(t.id));let o=a.map(t=>({text:t.title,value:{doc_id:t.id,title:t.title}}));if(0===o.length)return[{value:null,text:"No streams found"}];return o},e.setStreamMembers=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if("stream"!==app.state.get(["docLabel"]))return;const{docs:e,pagination:s}=await f.searchDocs({schema_name:"story",stream_id:app.state.get(["doc","id"]),order:"date",page:t});app.state.set(["stream","docs"],e),app.state.set(["stream","pagination"],s)};const a=s("f0Wu"),{orderBy:r,property:o}=s("LvDl"),n=s("6BrB"),i=s("heuk"),l=s("DkB1"),u=s("V8PI"),d=s("FtOp"),c=s("lvH+"),f=s("SiKE"),p=s("dnr0"),{toPlaintext:h}=s("K5N4"),m=s("oRyF"),g=s("AUQt"),v=s("Dh7P"),_=s("Lly2"),{INVALID_STREAM_MEMBERSHIP:b}=s("6fkZ");function y(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=d(e),a=""===e?t.title:x(t.title,s);a=`<span class='p-story__result__title'>${a}</span>`;let r=n.sentences(h(t.head.contents.draft.body),{sanitize:!0}),o=r.find(t=>s.test(t)),l=o?x(o,s):r[0];l&&(l=`<p class='p-story__result__dek'>${l}</p>`);let c=i(t.contributors.map(t=>`<span class='p-story__result__byline'>${t.fullOrUserName}</span>`)),f=t.head.contents.hidden?"Hidden":m(t.status.toLowerCase()),p=O(t),g=`\n    <span class='p-story__result__status ${f.toLowerCase()}'>${f}</span>\n    ${u(t.status)?"by "+c:""}\n    ${"Draft"===f?"modified on":"on"}\n    <span class='p-story__result__date'>${p}</span>\n  `,v=l?l+g:g;return{text:a,additional_text:v,value:{doc_id:t.id}}}function x(t,e){return t.replace(e,t=>`<span class='p-story__result__highlight'>${t}</span>`)}function M(t,e){let s=app.state.get("doc");if(u(s.status)&&u(e.status)){let a=l(s.entry_id),r=(t,e)=>`<a href="${t}" target="_blank" rel="nofollow noopener">${e}</a>`,o=`A story was ${t}. ${r("/compose/"+e.uuid,"Edit story")} ${r(a,"View stream")}.`;c.showMessage({type:"positive",message:o})}}function O(t){let e=u(t.status)?g(t.head.contents.publish_history,["published","published_via_schedule","backdated"]):t.updated_at;return a(e).format(app.config.dateFormat)}},"0y21":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a},o=s("tNa1");const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";class i{constructor(t){this.quill=t,this.ignoreChange=!1,this.quill.on("debounced-text-change",(t,e,s)=>{this.ignoreChange||"user"!==s||this.insertIds()})}insertIds(){const t=this.quill.getContents(),e=new o.Delta,s=new Set;for(let a of t.ops)if("string"!=typeof a.insert)e.retain(1);else{let t=a.insert,r=t.indexOf("\n");for(;r>=0;)e.retain(r),null==a.attributes||null==a.attributes.id||s.has(a.attributes.id)?e.retain(1,{id:this.makeId(s)}):(s.add(a.attributes.id),e.retain(1)),t=t.slice(r+1),r=t.indexOf("\n");e.retain(t.length)}e.chop().length()>0&&(this.ignoreChange=!0,this.quill.updateContents(e,"user"),this.ignoreChange=!1)}makeId(t){let e;do{e="";for(let t=0;t<6;t++)e+=n.charAt(Math.floor(Math.random()*n.length))}while(t.has(e));return t.add(e),e}}r.default.register("modules/line-ids",i);var l=i;e.default=l,t.exports=e.default},"13V3":function(t,e,s){"use strict";t.exports=function(t){return t&&"unison_standard"!==t}},"1F8a":function(t,e,s){"use strict";var a=s("tNa1").Delta;t.exports=function(t,e){var s=0;return t.ops.reduce((t,r)=>(r.hasOwnProperty("attributes")&&e(r)&&t.push(s),s+=new a([r]).length(),t),[])}},"1NEY":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=r(s("fEA7"));function r(t){return t&&t.__esModule?t:{default:t}}const o=r(s("IUmz")).default.import("parchment");class n extends o.Embed{static create(t){let e=super.create(t);return e.dataset.object=JSON.stringify({[this.blotName]:t}),e.dataset.frameId=a.default.v4(),e.allowFullscreen=!0,e.src="/object-v2.html?parents="+function(){let t=0,e=window;for(;window&&e!==window.top;)t+=1,e=e.parent;return t}(),e}static value(t){try{if(t.dataset.object)return JSON.parse(t.dataset.object)[this.blotName]}catch(t){return}}static get className(){return this.blotName+"-object"}}n.blotName="abstract",n.tagName="iframe";var i=n;e.default=i,t.exports=e.default},"2cuI":function(t,e,s){"use strict";t.exports=function(t){if(0===t.length)return!1;var e=parseInt(t[0].grouping.charAt(0),10);return t.length===e}},"4DkZ":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("xnob"));function o(t){return t&&t.__esModule?t:{default:t}}class n{constructor(t){const e=()=>{this.delta=null,this.oldContents=null,this.source=null},s=()=>{this.delta&&this.oldContents&&this.source&&t.emitter.emit("debounced-text-change",this.delta,this.oldContents,this.source),e()},a=(0,r.default)(s);t.on("text-change",(t,e,r)=>{this.source&&r!==this.source&&s(),this.oldContents||(this.oldContents=e),this.delta?this.delta=this.delta.compose(t):this.delta=t,this.source=r,a()})}}a.default.register("modules/debounced-text-change",n);var i=n;e.default=i,t.exports=e.default},"62z8":function(t,e,s){"use strict";var a;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const r=((a=s("IUmz"))&&a.__esModule?a:{default:a}).default.import("parchment");class o extends r.Attributor.Attribute{constructor(t,e){super(t,"data-"+t,e)}canAdd(t,e){return!0===e&&super.canAdd(t,e)}add(t,e){return!!this.canAdd(t,e)&&(t.dataset[this.attrName]="",!0)}value(t){return""===t.dataset[this.attrName]}remove(t){delete t.dataset[this.attrName]}}e.default=o,t.exports=e.default},"7LCa":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("1NEY"));function o(t){return t&&t.__esModule?t:{default:t}}class n extends r.default{static create(t){let e=super.create(t);return e.dataset.preserveHeight="",e}}n.blotName="image",a.default.register("formats/image",n);var i=n;e.default=i,t.exports=e.default},"7ZvW":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=n(s("IUmz")),r=n(s("Y0mq")),o=n(s("/LyM"));function n(t){return t&&t.__esModule?t:{default:t}}class i extends r.default{format(t){let e=this.quill.selection.savedRange;0===e.length&&this.linkRange&&(e=this.linkRange);let s=this.quill.getContents(e).ops[0];if(!s||!s.attributes||!s.attributes.autolink)return;let a=Object.assign({},s.attributes.autolink);t?a.href=t:a.disabled=!0,this.quill.formatText(e,"autolink",a,"user")}onSelectionChange(t){if(null==t)return;let[e,s]=this.quill.scroll.descendant(o.default,t.index);if(null!=e&&s+t.length<=e.length()){let a=o.default.formats(e.domNode);a.disabled?this.hide():(this.preview.textContent=a.href,this.preview.href=a.href,this.linkRange={index:t.index-s,length:e.length()},this.show())}else this.hide()}}a.default.register("modules/autolink-tooltip",i);var l=i;e.default=l,t.exports=e.default},"7nug":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){a=r(),window.addEventListener("keypress",o,!1),window.addEventListener("click",o,!1),app.on("autosave.local-update",o),app.on("autosave.remote-update",o)};let a=null;function r(){return setTimeout(()=>{app.emit("socket.disconnect","stale-tab")},app.config.sockets.inactivePeriod)}function o(){clearTimeout(a),a=r()}t.exports=e.default},"8F6U":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/inline");class n extends o{static formats(){return!0}optimize(t){super.optimize(t),"STRONG"!==this.domNode.tagName&&this.replaceWith("bold")}}n.blotName="bold",n.tagName=["STRONG","B"],r.default.register("formats/bold",n);var i=n;e.default=i,t.exports=e.default},"8Hqk":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("YfyZ"));function o(t){return t&&t.__esModule?t:{default:t}}class n extends r.default{}n.blotName="bullet",n.tagName="UL",a.default.register("formats/bullet",n);var i=n;e.default=i,t.exports=e.default},"8Xfq":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/inline");class n extends o{static formats(){return!0}optimize(t){super.optimize(t),"S"!==this.domNode.tagName&&this.replaceWith("strike")}}n.blotName="strike",n.tagName=["S","STRIKE"],r.default.register("formats/strike",n);var i=n;e.default=i,t.exports=e.default},"9LOy":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){if(0===app.state.get(["doc","head","contents","draft","contributors"]).length){var t=app.state.get(["doc","user_id"]),e=-1===t?app.state.get(["user","id"]):t;return a.addContributor(e,0,-1)}};var a=s("cgT3");t.exports=e.default},"9gIt":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("1NEY"));function o(t){return t&&t.__esModule?t:{default:t}}class n extends r.default{}n.blotName="oembed",a.default.register("formats/oembed",n);var i=n;e.default=i,t.exports=e.default},AdKA:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("1NEY"));function o(t){return t&&t.__esModule?t:{default:t}}class n extends r.default{}n.blotName="ratingcard",a.default.register("formats/ratingcard",n);var i=n;e.default=i,t.exports=e.default},BL9Z:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};class o{constructor(t){t.on("debounced-text-change",(e,s,a)=>{if("user"!==a||!e.ops.some(t=>t.delete))return;let r=0;for(let a of e.ops){if(!a.delete){r+=a.retain||0;continue}if(!s.slice(r,r+a.delete).ops.some(t=>/\n/.test(t.insert)))continue;let e=n(s,r),o=n(s,r+a.delete);e.br!==o.br&&t.formatLine(r,1,{br:o.br},"user")}})}}function n(t,e){for(let s of t.slice(e).ops)if("string"==typeof s.insert&&s.insert.includes("\n"))return s.attributes||{};return{}}r.default.register("modules/soft-breaks",o);var i=o;e.default=i,t.exports=e.default},BMal:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("1NEY"));function o(t){return t&&t.__esModule?t:{default:t}}class n extends r.default{}n.blotName="pullquote",a.default.register("formats/pullquote",n);var i=n;e.default=i,t.exports=e.default},"Bng+":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("1NEY"));function o(t){return t&&t.__esModule?t:{default:t}}class n extends r.default{}n.blotName="toh_tools",a.default.register("formats/toh_tools",n);var i=n;e.default=i,t.exports=e.default},Ccv1:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("/+VR"));function o(t){return t&&t.__esModule?t:{default:t}}const n=a.default.import("modules/clipboard");class i extends n{convert(t){if(t)return super.convert(t);var e;!function(t){for(let e of t.children)if(/^docs-internal-guid/.test(e.id)){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.parentNode.removeChild(e)}}(this.container),function(t){const e=Array.from(t.children);for(let s=0;s<e.length;s++){const a=e[s];l(a)&&(t.removeChild(a),s++)}}(this.container),(e=this.container).innerHTML=e.innerHTML.replace(/(^|[^-—])--($|[^-—])/gm,"$1—$2");const s=super.convert();return(0,r.default)(s)}}function l(t){return"IFRAME"!==t.tagName&&(0===t.childNodes.length||1===t.childNodes.length&&"BR"===t.firstChild.tagName)}a.default.register("modules/clipboard",i,!0);var u=i;e.default=u,t.exports=e.default},CiTv:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const t=app.state.get(["doc","head","contents","comments_closed"]);"custom story"===app.state.get(["docLabel"])&&!0!==t?a.localUpdate(app.state.get(["doc","id"]),[{p:["comments_closed"],oi:!0}],-1):null==t&&a.localUpdate(app.state.get(["doc","id"]),[{p:["comments_closed"],oi:app.state.get(["community","commentsClosedDefault"])}],-1)};const a=s("dnr0");t.exports=e.default},Cn6n:function(t,e,s){"use strict";var a=s("LvDl").clone,r=s("LvDl").pick;t.exports=function(t,e){return{ops:t.ops.map((function(t){return(t=a(t)).attributes&&(t.attributes=r(t.attributes,e)),t}))}}},E9vD:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};class o{constructor(t,e){this.quill=t,"string"==typeof e.container?this.container=document.querySelector(e.container):this.container=e.container,this.container instanceof HTMLElement?(this.quill.on("editor-change",(t,e)=>{"selection-change"===t&&this.update(e)}),this.quill.on("scroll-optimize",()=>{let[t]=this.quill.selection.getRange();this.update(t)})):console.error("Container required for toolbar",e)}update(t){let e=null==t?{}:this.quill.getFormat(t),s=this.container.querySelectorAll("button");for(let a of s){let s=Array.from(a.classList).find(t=>0===t.indexOf("ql-"));s&&(s=s.slice("ql-".length),null==t?a.classList.remove("ql-active"):a.classList.toggle("ql-active",null!=e[s]))}}}r.default.register("modules/toolbar",o);var n=o;e.default=n,t.exports=e.default},FtOp:function(t,e,s){"use strict";t.exports=function(t){var e=t.split(" ");return e=(e=(e=e.filter(t=>""!==t)).join("|")).replace(/[-[\]{}()*+?.,\\^$]/g,"\\$&"),new RegExp(e,"gi")}},GWry:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return a.parse(window.location.search.replace("?",""))};var a=s("s4NR");t.exports=e.default},Hbl4:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return r(t).reduce((e,s)=>{if(!n(s)||!function(t,e){return i(e.map(e=>o(t,e.offset-1).insert))}(t,s))for(let t of s)e=e.compose((r=t.offset,(new a).retain(r).retain(1,{grouping:null})));var r;return e},new a).chop()};var{Delta:a}=s("tNa1"),r=s("KSqv"),o=s("QE0c"),n=s("2cuI"),i=s("/p+M");t.exports=e.default},Hulb:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/block");class n extends o{}n.blotName="fifthheader",n.tagName="H5",r.default.register("formats/fifthheader",n);var i=n;e.default=i,t.exports=e.default},JIqk:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("62z8"));function o(t){return t&&t.__esModule?t:{default:t}}const n=a.default.import("parchment"),i=new r.default("endmark",{scope:n.Scope.BLOCK});a.default.register("formats/endmark",i);var l=i;e.default=l,t.exports=e.default},KSqv:function(t,e,s){"use strict";var a=s("U9Hs"),r=s("2cuI");t.exports=function(t){var e=0,s=[];for(let a of t.ops)a.attributes&&a.attributes.grouping&&s.push({id:a.attributes.id,offset:e,grouping:a.attributes.grouping}),e+="string"==typeof a.insert?a.insert.length:1;return a(s,(t,e)=>{var s=t[t.length-1];return e.grouping===s.grouping&&e.offset-s.offset==2&&!r(t)})}},"M7L/":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/inline");class n extends o{}n.blotName="ins",n.tagName="INS",r.default.register("formats/ins",n);var i=n;e.default=i,t.exports=e.default},MyxB:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("62z8"));function o(t){return t&&t.__esModule?t:{default:t}}const n=a.default.import("parchment"),i=new r.default("br",{scope:n.Scope.BLOCK});a.default.register("formats/br",i);var l=i;e.default=l,t.exports=e.default},OIeu:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/block");class n extends o{}n.blotName="thirdheader",n.tagName="H3",r.default.register("formats/thirdheader",n);var i=n;e.default=i,t.exports=e.default},PGIN:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/block");class n extends o{}n.blotName="secondheader",n.tagName="H2",r.default.register("formats/secondheader",n);var i=n;e.default=i,t.exports=e.default},QA8J:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){},s("fs64"),s("fdIg"),s("XGLB"),s("TnW+"),s("8F6U"),s("MyxB"),s("8Hqk"),s("SLFd"),s("nOQM"),s("TVcn"),s("xLIX"),s("JIqk"),s("Hulb"),s("yvpA"),s("f9N+"),s("SW/N"),s("TEQS"),s("ucui"),s("yez/"),s("7LCa"),s("M7L/"),s("nDca"),s("qaub"),s("wq+M"),s("/LyM"),s("YfyZ"),s("ms78"),s("ikdh"),s("oxsl"),s("9gIt"),s("rIX1"),s("BMal"),s("r2Vq"),s("AdKA"),s("i64J"),s("PGIN"),s("yB7W"),s("8Xfq"),s("+GB8"),s("VhHV"),s("OIeu"),s("t0cq"),s("Bng+"),s("RCco"),s("7ZvW"),s("Ccv1"),s("4DkZ"),s("m2O/"),s("huVF"),s("eMXn"),s("0y21"),s("Y0mq"),s("qfmV"),s("bnEs"),s("e4Gc"),s("BL9Z"),s("E9vD"),t.exports=e.default},QE0c:function(t,e,s){"use strict";var a=s("tNa1").Delta;t.exports=function(t,e){return new a(t).slice(e).ops[0]}},QhRk:function(t,e,s){"use strict";var{Delta:a}=s("tNa1"),r=s("JUFS").attributes.properties;function o(t,e){var s=t.attributes||{};return Object.keys(s).reduce((t,s)=>{var a=r[s];return a&&e.includes(a.context)||(t[s]=null),t},{})}t.exports=function(t){var e=new a,s=!1;for(let a of t.ops)"string"!=typeof a.insert?(e.retain(1,o(a,["object","any"])),s=!0):/^\n+$/.test(a.insert)?(e.retain(1,o(a,[s?"object-line":"text-line","any-line","any"])),s=!1):(e.retain(a.insert.length,o(a,["text","any"])),s=!1);return e}},RCco:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("1NEY"));function o(t){return t&&t.__esModule?t:{default:t}}class n extends r.default{static create(t){let e=super.create(t);return e.dataset.preserveHeight="",e}}n.blotName="video",a.default.register("formats/video",n);var i=n;e.default=i,t.exports=e.default},SLFd:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("1NEY"));function o(t){return t&&t.__esModule?t:{default:t}}class n extends r.default{}n.blotName="credits",a.default.register("formats/credits",n);var i=n;e.default=i,t.exports=e.default},"SW/N":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("parchment"),n=new o.Attributor.Attribute("grouping","data-grouping",{scope:o.Scope.BLOCK});r.default.register("formats/grouping",n);var i=n;e.default=i,t.exports=e.default},Syya:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return["DRAFT","SUBMITTED","APPROVED"].includes(t)},t.exports=e.default},TEQS:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("1NEY"));function o(t){return t&&t.__esModule?t:{default:t}}class n extends r.default{static create(t){let e=super.create(t);return e.dataset.preserveHeight="",e}}n.blotName="hr",a.default.register("formats/hr",n);var i=n;e.default=i,t.exports=e.default},TVcn:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("1NEY"));function o(t){return t&&t.__esModule?t:{default:t}}const n=["gallery","imageslider","ratingcard"];class i extends r.default{static create(t){let e=super.create(t);return e.classList.add(t.type+"-object"),n.includes(t.type)&&(e.dataset.preserveHeight=""),e}}i.blotName="doc",a.default.register("formats/doc",i);var l=i;e.default=l,t.exports=e.default},"TnW+":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/block");class n extends o{}n.blotName="blockquote",n.tagName="BLOCKQUOTE",r.default.register("formats/blockquote",n);var i=n;e.default=i,t.exports=e.default},U9Hs:function(t,e,s){"use strict";t.exports=function(t,e){if(t.length<2)return[t];var s=[],a=[t[0]];for(let r of t.slice(1))e(a,r)?a.push(r):(s.push(a),a=[r]);return s.push(a),s}},VhHV:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/inline");class n extends o{}n.blotName="superscript",n.tagName="SUP",r.default.register("formats/superscript",n);var i=n;e.default=i,t.exports=e.default},X3Nb:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){window.addEventListener("beforeunload",t=>{if(app.state.get("appWorking"))return t.preventDefault(),t.returnValue=a,a})};var{UNSAVED_WARNING:a}=s("6fkZ");t.exports=e.default},XGLB:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=new(r.default.import("parchment").Attributor.Attribute)("author","data-author");r.default.register("formats/author",o);var n=o;e.default=n,t.exports=e.default},XRrU:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){if(o().communityChanged){const t=app.state.get(["docLabel"]);r.showMessage({type:"positive",message:a.replace("{docLabel}",t)})}};const{COMMUNITY_CHANGED:a}=s("6fkZ"),r=s("lvH+"),o=s("GWry");t.exports=e.default},Y0mq:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i(s("IUmz")),r=i(s("wq+M")),o=i(s("mKD4")),n=s("6fkZ");function i(t){return t&&t.__esModule?t:{default:t}}const l={maxLength:50,horizontalPadding:5,verticalPadding:5};class u{constructor(t,e){var s=this;this.quill=t,this.options=Object.assign({},l,e),this.root=t.addContainer("ql-link-tooltip"),this.root.innerHTML='\n  <div class="ql-link-tooltip__wrapper">\n    <a class="url" target="_blank" rel="external"></a>\n    <input type="text" class="input">\n    <a class="change">Change</a>\n    <a class="remove">Remove</a>\n    <a class="done">Done</a>\n  </div>\n  <div class="ql-link-tooltip__warning"></div>\n',this.textbox=this.root.querySelector("input"),this.preview=this.root.querySelector("a.url"),this.warning=this.root.querySelector(".ql-link-tooltip__warning"),this.textbox.addEventListener("keydown",t=>{"Enter"===t.key?(this.save(),t.preventDefault()):"Escape"===t.key&&(this.cancel(),t.preventDefault(),t.stopPropagation())}),this.root.querySelector("a.change").addEventListener("click",t=>{this.edit(this.preview.textContent),t.preventDefault()}),this.root.querySelector("a.done").addEventListener("click",t=>{this.save(),t.preventDefault()}),this.root.querySelector("a.remove").addEventListener("click",t=>{this.toggle(!1),t.preventDefault()}),this.quill.on("selection-change",(function(){for(var t=arguments.length,e=new Array(t),a=0;a<t;a++)e[a]=arguments[a];Promise.resolve().then(()=>s.onSelectionChange(...e))})),this.hide()}cancel(){this.quill.setSelection(this.quill.selection.savedRange,"user")}edit(t){this.root.classList.remove("hidden"),this.root.classList.add("editing"),this.textbox.value=t,this.position(this.quill.getBounds(this.quill.selection.savedRange)),this.textbox.select()}format(t){let e=this.quill.selection.savedRange;0===e.length&&this.linkRange&&(e=this.linkRange),this.quill.formatText(e,"link",t,"user")}hide(){this.root.classList.contains("hidden")||(this.root.removeAttribute("style"),this.root.classList.add("hidden"),this.setWarning(null))}normalize(t){return/^(https?:\/\/|mailto:)/.test(t)||(t="http://"+t),t}onSelectionChange(t){if(null==t)return;let[e,s]=this.quill.scroll.descendant(r.default,t.index);if(null!=e&&s+t.length<=e.length()){let a=r.default.formats(e.domNode);this.preview.textContent=a,this.preview.href=a,this.linkRange={index:t.index-s,length:e.length()},this.show()}else this.hide()}position(t){if(!document.body.contains(this.root))return;let e=t.left+t.width/2-this.root.offsetWidth/2,s=t.bottom+this.quill.container.scrollTop+this.options.verticalPadding;this.root.style.left=e+"px",this.root.style.top=s+"px",this.root.classList.remove("ql-flip");let a=this.root.offsetParent.getBoundingClientRect(),r=this.root.getBoundingClientRect();if(a.right-r.right<this.options.horizontalPadding){let t=a.right-r.right-2*this.options.horizontalPadding;this.root.style.left=e+t+"px"}if(r.left-a.left<this.options.horizontalPadding){let t=a.left-r.left+this.options.horizontalPadding;this.root.style.left=e+t+"px"}if(r.bottom>document.documentElement.clientHeight-this.options.verticalPadding){let e=t.height+r.height+2*this.options.verticalPadding;this.root.style.top=s-e+"px",this.root.classList.add("ql-flip")}}reposition(){this.root.classList.contains("hidden")||this.position(this.quill.getBounds(this.quill.selection.savedRange))}save(){let t=this.textbox.value;(0,o.default)(t)?(this.setWarning(null),t=this.normalize(t),this.format(t),this.quill.focus()):this.setWarning(n.INVALID_LINK_MESSAGE)}setWarning(t){this.warning.textContent=t,this.warning.classList.toggle("is-active",null!=t)}show(){this.root.classList.remove("editing"),this.root.classList.remove("hidden"),this.position(this.quill.getBounds(this.linkRange))}toggle(t){if(t){let t=this.quill.getSelection();if(null==t||0===t.length)return;let e=this.quill.getText(t);/^\S+@\S+\.\S+$/.test(e)&&0!==e.indexOf("mailto:")&&(e="mailto:"+e),this.edit(e)}else this.format(t),this.quill.focus(),this.hide()}}a.default.register("modules/link-tooltip",u);var d=u;e.default=d,t.exports=e.default},YfyZ:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("ms78"));function o(t){return t&&t.__esModule?t:{default:t}}const n=a.default.import("parchment"),i=a.default.import("blots/container");class l extends i{static formats(){return!0}format(t,e){this.children.length>0&&this.children.tail.format(t,e)}formats(){return{[this.statics.blotName]:!0}}insertBefore(t,e){if(t instanceof r.default)super.insertBefore(t,e);else{let s=null==e?this.length():e.offset(this),a=this.split(s);a.parent.insertBefore(t,a)}}optimize(t){super.optimize(t);let e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&(e.moveChildren(this),e.remove())}replace(t){if(t.statics.blotName!==this.statics.blotName){let e=n.create(this.statics.defaultChild);t.moveChildren(e),this.appendChild(e)}super.replace(t)}}l.blotName="list",l.scope=n.Scope.BLOCK_BLOT,l.tagName="OL",l.defaultChild="list-item",l.allowedChildren=[r.default],a.default.register("formats/list",l);var u=l;e.default=u,t.exports=e.default},"aK+E":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=app.state.select(["doc","head","contents","draft","package_toc"]);t.on("update",()=>u(t.get()));var e=app.state.select(["doc","head","contents","draft","package_cover"]);return e.on("update",()=>d(e.get())),d(e.get()),u(t.get())};var{difference:a}=s("LvDl"),r=s("dnr0"),o=s("1wDL"),n=s("SiKE");const i=["vertical","horizontal","fullwidth"],l=["1col","2col"];function u(t){var e,s=Object.keys(app.state.get(["packageDocs"])),i=o(t).map(t=>{let{uuid:e}=t;return e}),l=a(s,i),u=a(i,s);if(0!==l.length||0!==u.length)return(u.length>0?(e=u,n.searchDocs({uuids:e.join(",")}).then(t=>{let{docs:e}=t;return Promise.all(e.map(t=>r.setAndInitDoc(t)))})):Promise.resolve()).then(()=>{for(let e of l){var t=app.state.get(["packageDocs",e,"id"]);r.teardownDoc(t)}})}function d(t){var e=app.state.get(["doc","id"]);for(let[a,o]of t.entries()){var s;if(o.story)0===a&&l.includes(o.story.layout)?s="horizontal":a>0&&i.includes(o.story.layout)&&(s="1col"),s&&r.localUpdate(e,[{p:["draft","package_cover",a,"story","layout"],od:o.story.layout,oi:s}],-1)}}t.exports=e.default},bnEs:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=c(s("IUmz")),r=s("LvDl"),o=s("tNa1"),n=c(s("kSVm")),i=c(s("QhRk")),l=c(s("Hbl4")),u=c(s("ed+Z")),d=c(s("/MMw"));function c(t){return t&&t.__esModule?t:{default:t}}class f{constructor(t){(0,r.bindAll)(this,"onTextChange","onSelectionChange","onClick"),this.quill=t,this.selectedIframes=[],this.preventEdit=!1,t.on("debounced-text-change",this.onTextChange),t.on("selection-change",this.onSelectionChange),t.root.addEventListener("click",this.onClick)}destroy(){this.quill.root.removeEventListener("click",this.onClick)}onTextChange(){if(this.onSelectionChange(),!this.preventEdit){var t=this.buildFixDelta();t.length()>0&&(this.preventEdit=!0,this.quill.updateContents(t,"user"),this.preventEdit=!1)}}buildFixDelta(){var t=this.quill.getContents();return[n.default,i.default,l.default,u.default].reduce((e,s)=>{var a=t.compose(e);return e.compose(s(a))},new o.Delta).chop()}onSelectionChange(){if(document.activeElement===this.quill.root){var t=document.getSelection(),e=t.rangeCount>0&&t.getRangeAt(0);e&&(e.collapsed?this.selectIframes([]):this.selectIframes(function(t,e){var s=t.commonAncestorContainer;if(s.nodeType!==Node.ELEMENT_NODE)return[];var a=document.createRange();return[...s.querySelectorAll(e)].filter(e=>{a.selectNode(e);var s=t.compareBoundaryPoints(Range.START_TO_START,a)<=0,r=t.compareBoundaryPoints(Range.END_TO_END,a)>=0;return s&&r})}(e,"iframe")))}}onClick(t){if(this.quill.root.isContentEditable&&t.target&&"IFRAME"===t.target.tagName){var e=document.getSelection(),s=document.createRange();s.setStartBefore(t.target),s.setEndAfter(t.target),e.removeAllRanges(),e.addRange(s),this.quill.root.focus()}}selectIframes(t){var e=[],s=t.map(t=>(0,r.get)(t,["dataset","frameId"]));for(let t of this.selectedIframes){var a=(0,r.get)(t,["dataset","frameId"]),o=(0,r.get)(t,["contentWindow","document","body"]);s.includes(a)?e.push(a):(o&&(o.classList.remove("is-selected"),o.classList.remove("is-active")),app.emit("object.deselected",a))}if(t.length>0)for(let s of t)(0,d.default)(s).then(()=>{var a=s.dataset.frameId;e.includes(a)||(s.contentWindow.document.body.classList.add("is-selected"),s.contentWindow.document.body.classList.toggle("is-active",1===t.length),app.emit("object.selected",a),s.contentWindow.postMessage({event:"object.selected",payload:a},window.location.origin))});this.selectedIframes=t}}a.default.register("modules/object-behavior",f);var p=f;e.default=p,t.exports=e.default},"cXL+":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){if("boolean"==typeof app.state.get(["doc","head","contents","draft","slug_is_evergreen"]))return;const t=app.state.get(["community","entrySlugIsEvergreenDefault"]);if("boolean"!=typeof t)return;a.localUpdate(app.state.get(["doc","id"]),[{p:["draft","slug_is_evergreen"],oi:t}],-1)};var a=s("dnr0");t.exports=e.default},cgT3:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.addContributor=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;0===e&&u(t);i.localUpdate(app.state.get(["doc","id"]),[{p:["draft","contributors",e],li:{chorus_id:t}}],s)},e.contributorsForDoc=function(t){if(!t)return"";if(l(t.head.contents))return app.state.get(["community","network","name"])+" staff";let e=t.contributors||[];if(0===e.length)return t.owner.fullName;let s=e.slice(0,2),a=e.slice(2),r=s.map(t=>t.fullOrUserName).join(", ");a.length>0&&(r=`${r} +${a.length}`);return r},e.getContributors=async function(t){let e=app.state.get(["doc","head","contents","draft","contributors"]).map(t=>t.chorus_id),{searchUsers:s}=await n("/api/tower/graphql",{query:a,variables:{text:t,communityId:app.state.get(["doc","community_id"])}});return s.results.filter(t=>!e.includes(t.id))},e.removeContributor=function(t,e){0===e&&u(app.state.get(["doc","head","contents","draft","contributors",1,"chorus_id"]));i.localUpdate(app.state.get(["doc","id"]),[{p:["draft","contributors",e],ld:{chorus_id:t}}])};const{SearchContributors:a}=s("+0Ce"),r=s("5qpz"),o=s("V8PI"),n=s("XhB+"),i=s("dnr0"),l=s("AUH+");async function u(t){if(o(app.state.get(["doc","status"])))return;let e=[];const s=app.state.get(["doc","head","contents","draft","autotweets",1,"handle"])||null,a=t?await r.getTwitterUsername(t):null;a&&a!==s?e.push({p:["draft","autotweets",1,"handle"],od:s,oi:a}):s&&e.push({p:["draft","autotweets",1,"handle"],od:s}),e.length>0&&i.localUpdate(app.state.get(["doc","id"]),e,-1)}},cpE0:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.addGroup=function(t,e,s,a){var r=app.state.get(["doc","head","contents"]).draft[a+"s"],o=function t(e,s){if(e.parent_entry_group_id){var a=s.find(t=>t.id===e.parent_entry_group_id);if(a&&a.auto_add_subgroup_entries)return[e].concat(t(a,s))}return[e]}(e,t).reduce((t,e)=>(r.find(t=>t.id===e.id)||t.push({p:["draft",a+"s",s],li:h(e)}),t),[]);l.localUpdate(app.state.get(["doc","id"]),o)},e.groupFromData=h,e.loadGroup=function(t,e,s){return n(`/api/chorus/${t}s/${e}`,{query:{community_id:app.state.get(["doc","community_id"]),includes:s}}).then(c)},e.loadGroups=d,e.loadNestedGroups=function(t){var e={};return d(t).then(t=>{if(t.length>0){var s=t.filter(t=>null==t.parent_entry_group_id),a=i(s);e=function(t,e){for(let s of Object.values(t))for(let t of s)p(t,e);return t}(a,t)}return e})},e.removeGroup=function(t,e,s,a){var r=["draft",`primary_${a}_id`],o=["draft",a+"s"],n=app.state.get(["doc","head","contents",...o]),i=[];if(t===e){var u=n.find(t=>t.id!==e);u?i.push({p:r,od:e,oi:u.id}):i.push({p:r,od:e})}i.push({p:[...o,s],ld:n[s]}),l.localUpdate(app.state.get(["doc","id"]),i)},e.setPrimaryGroup=function(t,e){var s=["draft",`primary_${e}_id`],a=app.state.get(["doc","head","contents",...s]),r=app.state.get(["doc","id"]);l.localUpdate(r,[{p:s,od:a,oi:t}])};var{sortBy:a,pick:r,get:o}=s("LvDl"),n=s("kh36"),i=s("gmFb"),l=s("dnr0");const u=["id","name","slug","parent_entry_group_id","auto_add_subgroup_entries","is_disclaimer"];function d(t,e){return n("/api/chorus/"+t+"s",{query:{per_page:1e4,community_id:e||app.state.get("doc","community_id")},opts:{cache:!0}}).then(e=>e._embedded[t].map(t=>c(t,{includePlacementSlots:!1})))}function c(t){let{includePlacementSlots:e=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var s=r(t,u),a=o(t,["_embedded","hub_page"])||{};return s.hub_page_id=a.id||null,s.placement_slots=e?a.placement_slots||[]:null,s}function f(t,e){var s=e.filter(e=>e.parent_entry_group_id===t.id),r=a(s,"name");return t.children=r,r}function p(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;var a=f(t,e);if(t.depth=s,a.length>0){s++;for(let t of a)p(t,e,s)}}function h(t){var e=app.state.get(["community","placeFirstAvailableDefault"]),s=r(t,["id","hub_page_id","name","slug"]);return s.placement_slot=e?null:-1,s}},e4Gc:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i(s("IUmz")),r=s("LvDl"),o=i(s("Cn6n")),n=s("K5N4");function i(t){return t&&t.__esModule?t:{default:t}}class l{constructor(t,e){(0,r.bindAll)(this,"onFocus","onBlur","onTextChange"),this.quill=t,this.quill.on("debounced-text-change",this.onTextChange),this.quill.root.addEventListener("focus",this.onFocus),this.quill.root.addEventListener("blur",this.onBlur),this.container=t.addContainer("ql-placeholder"),this.options=e,this.set(e.placeholder),this.onTextChange()}showPlaceholder(){return"\n"===this.quill.getText()&&(document.activeElement!==this.quill.root||!document.hasFocus())}onFocus(){"\n"===this.quill.getText()&&this.quill.setContents(this.placeholder,"user")}onBlur(){(0,r.isEqual)(this.quill.getContents().ops,this.placeholder.ops)&&this.quill.setContents([],"user"),this.onTextChange()}onTextChange(){this.container.style.display=this.showPlaceholder()?"block":"none",this.options.autosize||this.matchSize()}set(t){null==t?t={ops:[{insert:"\n"}]}:"string"==typeof t&&(t={ops:[{insert:t+"\n"}]});var e=Object.keys(this.quill.scroll.whitelist).concat("author");this.placeholder=(0,o.default)(t,e),this.container.innerHTML=(0,n.toInlineHtml)(t,e),this.options.autosize||this.matchSize()}matchSize(){var t=this.quill.root;if(this.showPlaceholder()){var e=getComputedStyle(t),s=parseInt(e.borderTopWidth,10)+parseInt(e.borderBottomWidth,10);t.style.minHeight=this.container.scrollHeight+s+"px"}else t.style.minHeight=""}destroy(){this.quill.off("debounced-text-change",this.onTextChange),this.quill.root.removeEventListener("focus",this.onFocus),this.quill.root.removeEventListener("blur",this.onBlur)}}a.default.register("modules/placeholder",l);var u=l;e.default=u,t.exports=e.default},eMXn:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a},o=s("tNa1"),n=s("LvDl");class i{constructor(t){(0,n.bindAll)(this,["setTabbing","unsetTabbing"]),this.tabbing=!1,document.addEventListener("keydown",this.setTabbing),document.addEventListener("keyup",this.unsetTabbing),t.root.addEventListener("focus",()=>{this.tabbing&&t.setSelection(0,t.getLength(),"user")}),t.keyboard.bindings.Tab=[{key:"Tab",shiftKey:null,handler:()=>!0}],t.keyboard.bindings.Enter=[{key:"Enter",shiftKey:null,handler:()=>(t.setSelection(null,"user"),!1)}],t.on("debounced-text-change",(e,s,a)=>{if("user"!==a||!e.ops.some(t=>/\n/.test(t.insert)))return;const r=new o.Delta,n=t.getContents(),i=n.ops[n.ops.length-1];for(let t of n.ops)if("string"==typeof t.insert){let e=t.insert;t===i&&(e=e.slice(0,-1));let s=e.indexOf("\n");for(;s>=0;)r.retain(s),r.insert(" ",t.attributes),r.delete(1),e=e.slice(s+1),s=e.indexOf("\n");r.retain(e.length)}else r.retain(1);r.chop().length()>0&&t.updateContents(r,"user")})}setTabbing(){this.tabbing=!0}unsetTabbing(){this.tabbing=!1}teardown(){document.removeEventListener("keydown",this.setTabbing),document.removeEventListener("keyup",this.unsetTabbing)}}r.default.register("modules/inline-mode",i);var l=i;e.default=l,t.exports=e.default},"ed+Z":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=new r;for(let[r,u]of t.ops.entries()){var s=u.attributes||{},n=r>0?t.ops[r-1].insert:{},i=(s.hasOwnProperty("position")||s.hasOwnProperty("grouping"))&&("string"==typeof n||n.hr),l=a(Object.keys(n),o).length>0||n.doc&&o.indexOf(n.doc.type)>-1;i?e.retain(1,{position:null,grouping:null}):l&&!s.hasOwnProperty("position")?e.retain(1,{position:"float-right"}):e.retain("string"==typeof u.insert?u.insert.length:1)}return e.chop()};var{intersection:a}=s("LvDl"),{Delta:r}=s("tNa1");const o=["pullquote","aside","ratingcard"];t.exports=e.default},"f9N+":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/block");class n extends o{}n.blotName="fourthheader",n.tagName="H4",r.default.register("formats/fourthheader",n);var i=n;e.default=i,t.exports=e.default},fdIg:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("parchment"),n=new o.Attributor.Attribute("ad_placement","data-ad-placement",{scope:o.Scope.BLOCK});r.default.register("formats/ad_placement",n);var i=n;e.default=i,t.exports=e.default},fs64:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("1NEY"));function o(t){return t&&t.__esModule?t:{default:t}}class n extends r.default{}n.blotName="actionbox",a.default.register("formats/actionbox",n);var i=n;e.default=i,t.exports=e.default},gmFb:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return a(t,t=>{var e=t.name.charAt(0).toUpperCase();return r.test(e)?e:"#"})};var{groupBy:a}=s("LvDl");const r=/[A-Z#]/;t.exports=e.default},heuk:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){let e="";for(let[s,a]of t.entries())s>0&&t.length>2&&(e+=","),e+=" ",s>0&&s===t.length-1&&(e+="and "),e+=a;return e},t.exports=e.default},huVF:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("parchment"),n=r.default.import("modules/history");class i extends n{constructor(t,e){var s;super(t,e),s=this,this._undoOnBackspace=!1,t.on("editor-change",(function(){for(var t=arguments.length,e=new Array(t),a=0;a<t;a++)e[a]=arguments[a];let r=e.pop();"user"===r&&(s._undoOnBackspace=!1)})),t.keyboard.bindings.Backspace.unshift({key:"Backspace",collapsed:!0,handler:()=>!this._undoOnBackspace||(this.undo(),!1)})}change(t,e){if(0===this.stack[t].length)return;let s=this.stack[t].pop();this.stack[e].push(s),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(s[t],r.default.sources.USER),this.ignoreChange=!1;let a=s.index?s.index[t]:function(t){let e=t.reduce((function(t,e){return t+=e.delete||0}),0),s=t.length()-e;(function(t){let e=t.ops[t.ops.length-1];if(null==e)return!1;if(null!=e.insert)return"string"==typeof e.insert&&e.insert.endsWith("\n");if(null!=e.attributes)return Object.keys(e.attributes).some((function(t){return null!=o.query(t,o.Scope.BLOCK)}));return!1})(t)&&(s-=1);return s}(s[t]);this.quill.setSelection(a)}recordSelection(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,s=this.stack.undo[this.stack.undo.length-1];s&&(s.index={undo:t,redo:e})}transform(t){super.transform(t);for(let e of this.stack.undo)e.index&&(e.index.undo=t.transformPosition(e.index.undo,!0),e.index.redo=t.transformPosition(e.index.redo,!0));for(let e of this.stack.redo)e.index&&(e.index.undo=t.transformPosition(e.index.undo,!0),e.index.redo=t.transformPosition(e.index.redo,!0))}undoOnBackspace(){this._undoOnBackspace=!0}}r.default.register("modules/history",i,!0);var l=i;e.default=l,t.exports=e.default},i1r6:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const t=[],e=[["draft","custom_field_flags"],["draft","custom_field_texts"]];for(const s of e){"object"!=typeof app.state.get(["doc","head","contents",...s])&&t.push({p:s,oi:{}})}t.length>0&&a.localUpdate(app.state.get(["doc","id"]),t,-1)};var a=s("dnr0");t.exports=e.default},i64J:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("1NEY"));function o(t){return t&&t.__esModule?t:{default:t}}class n extends r.default{}n.blotName="readmore",a.default.register("formats/readmore",n);var i=n;e.default=i,t.exports=e.default},"ik+R":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=app.state.get(["doc","head","contents","draft","link_set_id"]),e=app.state.get(["doc","status"]),s=app.state.get(["doc","id"]);r().then(r=>{var n;t||"DRAFT"!==e?t&&!r.find(e=>e.id===t)&&a.localUpdate(s,[{p:["draft","link_set_id"],od:t,oi:null}],-1):(n=o()?r.find(t=>"Community"===t.name):r.find(t=>t.default))&&a.localUpdate(s,[{p:["draft","link_set_id"],oi:n.id}],-1)})};var a=s("dnr0"),{loadLinkSets:r}=s("+IiC"),{isCommunityPostAuthor:o}=s("Qw7n");t.exports=e.default},ikdh:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/inline");class n extends o{}n.blotName="mark",n.tagName="MARK",r.default.register("formats/mark",n);var i=n;e.default=i,t.exports=e.default},k9NW:function(t,e,s){"use strict";function a(t){Error.call(this),Error.captureStackTrace(this,a),this.docId=t.id,this.entryId=t.entry_id,this.message="Community mismatch between Content API doc and SBN entry"}s("MCLT").inherits(a,Error),a.prototype.name="CommunityMismatchError",a.prototype.status=500,t.exports=a},kSVm:function(t,e,s){"use strict";const{Delta:a}=s("tNa1");t.exports=function(t){let e=new a,s=!1,r=!0;for(let[a,o]of t.ops.entries()){const n=t.ops.slice(a).find(t=>/\n/.test(t.insert));"string"==typeof o.insert?(s&&"\n"!==o.insert.charAt(0)&&e.insert("\n",n.attributes),e.retain(o.insert.length),s=!1,r="\n"===o.insert.charAt(o.insert.length-1)):(r||e.insert("\n",n.attributes),e.retain(1),s=!0,r=!1)}return e.chop()}},lAyR:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){app.state.set("autosave",{dirty:{},inLine:{},inFlight:{},sentIds:{},quillContentPaths:{},reconnectingIds:{},initializingIds:{},docsById:{}}),app.contentApiSocket.on("autosave.remote-update",a),app.contentApiSocket.on("autosave.doc-update",(t,e,s)=>{e.includes("schema_version")&&(n.showMessage({type:"positive",message:i.RELOAD_REQUIRED,forceRefresh:!0}),l.stopAll()),o(t,e,s)}),app.on("autosave.error",()=>n.showError(i.REALTIME_ERROR)),app.once("autosave.error",t=>{app.contentApiSocket.off("autosave.remote-update",a),app.state.set(["autosave","error"],t)}),app.on("reconnect",r)};var{remoteUpdate:a,onReconnect:r,updateDocFlag:o}=s("dnr0"),n=s("lvH+"),i=s("6fkZ"),l=s("xtt9");t.exports=e.default},"m2O/":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a},o=s("tNa1");class n{constructor(t){let e=!1;t.on("debounced-text-change",(s,a,r)=>{if(e||"user"!==r)return;const n=t.getContents().reduce((t,e)=>t+("string"==typeof e.insert?e.insert:"!"),""),i=new o.Delta;let l=0;for(let t of s.ops)if(t.delete){if(t.delete>1){const t=n.charAt(l-1),e=n.charAt(l);" "===t&&" "===e&&(i.delete(1),l+=1)}}else{const e=t.retain||t.insert.length||1;i.retain(e),l+=e}i.chop().length()>0&&(e=!0,t.updateContents(i,"user"),e=!1)})}}r.default.register("modules/double-spaces",n);var i=n;e.default=i,t.exports=e.default},ms78:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("parchment"),n=r.default.import("blots/block");class i extends n{static formats(t){return t.tagName===this.tagName?void 0:super.formats(t)}format(t,e){"bullet"!==t&&"list"!==t||e?super.format(t,e):this.replaceWith(o.create(this.statics.scope))}remove(){null==this.prev&&null==this.next?this.parent.remove():super.remove()}replaceWith(t,e){if(this.parent.isolate(this.offset(this.parent),this.length()),t!==this.parent.statics.blotName)return this.parent.unwrap(),super.replaceWith(t,e);this.parent.replaceWith(t,e)}}i.blotName="list-item",i.tagName="LI",r.default.register("formats/list-item",i);var l=i;e.default=l,t.exports=e.default},n8TP:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){u("site_group"),app.state.get(["community","network","usesSuperGroups"])&&u("super_group");app.state.get(["community","network","usesCampaignGroups"])&&u("campaign_group")};const{forEachRight:a,uniq:r}=s("LvDl"),o=s("dnr0"),n=s("cpE0"),i=s("Syya"),{isCommunityPostAuthor:l}=s("Qw7n");async function u(t){const e=await n.loadGroups(t);await async function(t,e){const s=[],n=["draft",t+"s"],i=["draft",`primary_${t}_id`],l=app.state.get(["doc","head","contents",...i]);l&&!e.find(t=>{let{id:e}=t;return e===l})&&s.push({p:i,od:l});const u=app.state.get(["doc","head","contents",...n]),d=u.map(t=>t.id),c=d.length!==r(d).length;a(u,(t,a)=>{const r=e.find(e=>{let{id:s}=e;return s===t.id});if(!r||c&&d.slice(0,a).includes(t.id))s.push({p:[...n,a],ld:t});else{for(let e of["hub_page_id","name","slug"])t[e]!==r[e]&&s.push({p:[...n,a,e],od:t[e],oi:r[e]});if(!t.hasOwnProperty("placement_slot")){const t=app.state.get(["community","placeFirstAvailableDefault"]);s.push({p:[...n,a,"placement_slot"],oi:t?null:-1})}}}),s.length>0&&await o.resolveOnLocalUpdate(app.state.get(["doc","id"]),s,-1)}(t,e),"site_group"===t&&function(t){const e=i(app.state.get(["doc","status"])),s=app.state.get(["doc","head","contents","draft","site_groups"]);let a;l()?a=t.find(t=>{let{slug:e}=t;return"community"===e}):(a=t.find(t=>{let{slug:e}=t;return e===app.state.get(["community","defaultGroupSlug"])}),a||(a=t.find(t=>{let{slug:e}=t;return"front-page"===e})));a&&e&&0===s.length&&o.localUpdate(app.state.get(["doc","id"]),[{p:["draft","primary_site_group_id"],oi:a.id},{p:["draft","site_groups",0],li:n.groupFromData(a)}],-1)}(e)}t.exports=e.default},nDca:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/inline");class n extends o{static formats(){return!0}optimize(t){super.optimize(t),"EM"!==this.domNode.tagName&&this.replaceWith("italic")}}n.blotName="italic",n.tagName=["EM","I"],r.default.register("formats/italic",n);var i=n;e.default=i,t.exports=e.default},nOQM:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/inline");class n extends o{}n.blotName="del",n.tagName="DEL",r.default.register("formats/del",n);var i=n;e.default=i,t.exports=e.default},oxsl:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("1NEY"));function o(t){return t&&t.__esModule?t:{default:t}}class n extends r.default{}n.blotName="newsletter",a.default.register("formats/newsletter",n);var i=n;e.default=i,t.exports=e.default},qaub:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("62z8"));function o(t){return t&&t.__esModule?t:{default:t}}const n=a.default.import("parchment"),i=new r.default("leadgraf",{scope:n.Scope.BLOCK});a.default.register("formats/leadgraf",i);var l=i;e.default=l,t.exports=e.default},qfmV:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o={timeout:2500};class n{constructor(t,e){this.quill=t,this.options=Object.assign({},o,e),this.container=t.addContainer("ql-multi-cursor"),this.cursors={},t.on("text-change",this._applyDelta,this)}clearCursors(){for(let t of Object.keys(this.cursors))this.removeCursor(t);this.cursors={}}moveCursor(t,e){const s=this.cursors[t];if(null!=s)return s.index=e,s.elem.classList.remove("hidden"),clearTimeout(s.timer),s.timer=setTimeout(()=>{s.elem.classList.add("hidden"),s.timer=null},this.options.timeout),this._updateCursor(s),s}removeCursor(t){const e=this.cursors[t];e&&e.elem.parentNode.removeChild(e.elem),delete this.cursors[t]}setCursor(t,e,s,a){return null==this.cursors[t]&&(this.cursors[t]={id:t,index:e,color:a,elem:this._buildCursor(s,a)}),setTimeout(()=>{this.moveCursor(t,e)},0),this.cursors[t]}shiftCursors(t,e){for(let s of Object.values(this.cursors)){if(!s||s.index<=t)continue;const a=Math.max(e,t-s.index);s.index+=a}}update(){for(let t of Object.values(this.cursors))t&&this._updateCursor(t)}_applyDelta(t){let e=0;for(let s of t.ops){let t=0;s.insert?this.shiftCursors(e,s.insert.length||1):s.delete?this.shiftCursors(e,-1*s.delete):s.retain&&(this.shiftCursors(e,0),t=s.retain),e+=t}this.update()}_buildCursor(t,e){const s=document.createElement("span");s.classList.add("cursor"),s.innerHTML='\n  <span class="cursor-flag">\n    <span class="cursor-name"></span>\n  </span>\n  <span class="cursor-caret"></span>\n';const a=s.querySelector(".cursor-name");a.textContent=t;return s.querySelector(".cursor-caret").style.backgroundColor=a.style.backgroundColor=e,this.container.appendChild(s),s}_updateCursor(t){const e=this.quill.getBounds(t.index);if(!e)return this.removeCursor(t.id);t.elem.style.top=e.top+this.quill.container.scrollTop+"px",t.elem.style.left=e.left+"px",t.elem.style.height=e.height+"px";const s=t.elem.querySelector(".cursor-flag");t.elem.classList.toggle("top",parseInt(t.elem.style.top,10)<=s.offsetHeight),t.elem.classList.toggle("left",parseInt(t.elem.style.left,10)<=s.offsetWidth),t.elem.classList.toggle("right",this.quill.root.offsetWidth-parseInt(t.elem.style.left,10)<=s.offsetWidth)}}r.default.register("modules/multi-cursor",n);var i=n;e.default=i,t.exports=e.default},r2Vq:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("1NEY"));function o(t){return t&&t.__esModule?t:{default:t}}class n extends r.default{}n.blotName="pym",a.default.register("formats/pym",n);var i=n;e.default=i,t.exports=e.default},rIX1:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("parchment"),n=new o.Attributor.Attribute("position","data-position",{scope:o.Scope.BLOCK});r.default.register("formats/position",n);var i=n;e.default=i,t.exports=e.default},sBhV:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){var s=t.pathname.slice(1).split("/",2).pop(),q=app.state.get(["doc"]);if(null!=q&&q.uuid===s)return e();d(),i.getDoc(s).then(t=>o.setDoc(t,["doc"])).then(()=>function(t){var e=app.state.get(["doc","head","contents","trashed_at"]),s=a().subtract(30,"days");if(e&&a(e)<s)return app.render(r),t();return Promise.resolve()}(e)).then(()=>async function(){const t=await l.getEntryById(app.state.get(["doc","entry_id"]));if(t&&t.community_id&&app.state.get(["doc","community_id"])!==t.community_id)throw app.render(r),new u(app.state.get(["doc"]))}()).then(()=>n.loadCommunity(app.state.get(["doc","community_id"]),"Editor")).then(()=>o.initDoc(app.state.get(["doc","id"]),!0)).then(()=>(c(),f(),p(),h(),m(),function(){O(),k(),w(),v(),y(),x(),M();var t=app.state.get(["docLabel"]);"page"!==t&&(P(),C(),N());"stream"===t&&b();if("package"===t)return _();if("custom story"===t)return g();return Promise.resolve()}())).then(()=>e()).catch(I.handleError)};var a=s("wd/R"),r=s("YS4a"),o=s("dnr0"),n=s("u6+C"),i=s("SiKE"),l=s("4mBr"),u=s("k9NW"),d=s("lAyR"),c=s("QA8J"),f=s("X3Nb"),p=s("7nug"),h=s("ulV0"),m=s("XRrU"),g=s("yMr/"),v=s("vmsY"),_=s("aK+E"),b=s("zvOj"),y=s("CiTv"),x=s("cXL+"),M=s("i1r6"),O=s("xJ/D"),k=s("9LOy"),N=s("zp1Z"),w=s("tiJM"),P=s("n8TP"),C=s("ik+R"),I=s("q1SX");t.exports=e.default},t0cq:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("1NEY"));function o(t){return t&&t.__esModule?t:{default:t}}class n extends r.default{}n.blotName="toh_project_details",a.default.register("formats/toh_project_details",n);var i=n;e.default=i,t.exports=e.default},tiJM:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=app.state.get(["doc","head","contents"]),e=t.main_media_type,s=[];e&&s.push({p:["main_media_type"],od:e});if(e&&("VIDEO"===e||"NONE"===e)){var r=t.main_image,o=t.internal_image;s=s.concat([{p:["main_image"],od:r},{p:["internal_image"],od:o,oi:r}])}s.length>0&&a.localUpdate(app.state.get(["doc","id"]),s,-1)};var a=s("dnr0");t.exports=e.default},ucui:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("1NEY"));function o(t){return t&&t.__esModule?t:{default:t}}class n extends r.default{static create(t){let e=super.create(t);return e.dataset.preserveHeight="",e}}n.blotName="html",a.default.register("formats/html",n);var i=n;e.default=i,t.exports=e.default},ulV0:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){setTimeout(()=>n(),100),app.state.select("users").on("update",n)};var a=s("6fkZ"),r=s("lvH+"),o=!1;function n(){!o&&app.state.get("users").length>10&&(o=!0,r.showMessage({message:a.TOO_MANY_EDITORS,type:"cautionary"}))}t.exports=e.default},vmsY:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=app.state.select(["doc","head","contents","draft","entry_layout"]);t.on("update",()=>{"unison_standard"===t.get()&&function(){var t=app.state.get(["doc","head","contents","draft","body"]),e=r(t,t=>t.attributes.hasOwnProperty("position")&&i.test(t.attributes.position));if(e.length>0){var s=e.map(t=>({p:["draft","body"],t:"rich-text",o:(new a).retain(t).retain(1,{position:null})}));o.localUpdate(app.state.get(["doc","id"]),s,-1)}}()});var e=app.state.select(["doc","head","contents","draft","main_gallery"]);e.on("update",()=>{var s=t.get();e.get()&&n(s)&&o.localUpdate(app.state.get(["doc","id"]),[{p:["draft","entry_layout"],od:s,oi:"unison_standard"}],-1)})};var{Delta:a}=s("tNa1"),r=s("1F8a"),o=s("dnr0"),n=s("13V3");const i=/(hang-left|hang-right|full-bleed|wide-block)/;t.exports=e.default},"wq+M":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,s("Kz25");var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/inline"),n=["http:","https:","mailto:","tel:"],i="about:blank";function l(t){try{return n.includes(new URL(t).protocol)?t:i}catch(t){return i}}class u extends o{static create(t){const e=l(t),s=e!==i;let a=super.create(e);return s&&(a.setAttribute("href",e),a.setAttribute("target","_blank")),a}static formats(t){return t.getAttribute("href")}format(t,e){const s=l(e);if(t!==this.statics.blotName||!e||s===i)return super.format(t,e);this.domNode.setAttribute("href",s)}}u.blotName="link",u.tagName="A",u.className="ql-link",r.default.register("formats/link",u);var d=u;e.default=d,t.exports=e.default},"xJ/D":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(){let t=app.state.get(["doc","head","contents","draft","autotweets"]);const e=app.state.get(["doc","head","contents","draft","contributors",0,"chorus_id"]),s=e&&!a(t,[1,"handle"])?await o.getTwitterUsername(e):null,i=app.state.get(["community"]);let l=[];t||(t=[{},{}],l.push({p:["draft","autotweets"],oi:t}));for(let[e,a]of["community","user"].entries()){let r=t[e];r||(r={},l.push({p:["draft","autotweets",e],li:r}));const o={context:a,handle:"community"===a?i.twitterScreenName:s,selected:i.twitterSendDefault,image:i.tweetWithImageByDefault,body:n("")};for(let[t,s]of Object.entries(o))null==r[t]&&null!=s&&l.push({p:["draft","autotweets",e,t],oi:s})}l.length>0&&r.localUpdate(app.state.get(["doc","id"]),l,-1)};const{get:a}=s("LvDl"),r=s("dnr0"),o=s("5qpz"),n=s("oRrG");t.exports=e.default},xLIX:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(s("IUmz")),r=o(s("62z8"));function o(t){return t&&t.__esModule?t:{default:t}}const n=a.default.import("parchment"),i=new r.default("dropcap",{scope:n.Scope.BLOCK});a.default.register("formats/dropcap",i);var l=i;e.default=l,t.exports=e.default},xnob:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){let e=!1;return function(){for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];e||(e=!0,Promise.resolve().then(()=>{try{t.apply(this,a)}finally{e=!1}}))}},t.exports=e.default},xtt9:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.start=function(t,e,s){l(e,s);var r=setInterval(()=>function t(e,s,r,l){var u=app.state.get("autosave","error");if(!n.isDirty(s)&&!u){var c=n.getDocCursor(s).get(["head","contents"].concat(r)),f=e.getContents(),p=new a(c).diff(f);if(p.length()>0)if(l){var h=new Error("Unexpected state mismatch at path: "+r);h.state=c,h.quill=f,h.diff=p,app.emit("autosave.error",h),o.reportError(h,!1)}else{var m=setTimeout(()=>t(e,s,r,!0),1e4);i[d(s,r)]=m}}}(t,e,s),app.config.stateObserverInterval);i[u(e,s)]=r},e.stop=l,e.stopAll=function(){for(let t of Object.keys(i))clearInterval(i[t]),i[t]=null};var{Delta:a}=s("tNa1"),r=s("Fw7v"),o=s("q1SX"),n=s("dnr0"),i={};function l(t,e){var s=u(t,e);i[s]&&(clearInterval(i[s]),i[s]=null);var a=d(t,e);i[a]&&(clearTimeout(i[a]),i[a]=null)}function u(t,e){return r(t+e)}function d(t,e){return r(t+e+"error")}},yB7W:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/inline");class n extends o{}n.blotName="small",n.tagName="SMALL",r.default.register("formats/small",n);var i=n;e.default=i,t.exports=e.default},"yMr/":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(){0===app.state.get(["doc","head","contents","draft","customstory_pages"]).length&&await a(0);return app.state.set(["customstoryStatus"],{statusLabel:"Working",statusMessage:"",statusPending:!0}),n(),Promise.resolve()};const{addPage:a,getCustomstoryStatus:r}=s("FVbV");async function o(t){await new Promise(e=>{setTimeout(e,t)})}async function n(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;for(;t>0;){app.state.get("customstoryBuildSent")&&(t=1e3,app.state.set("customstoryBuildSent",!1)),await o(1e3),t-=1e3}i()}async function i(){const{statusLabel:t}=await r();let e=3e4;["Building","Build queued"].includes(t)&&(e=5e3),n(e)}t.exports=e.default},"yez/":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("parchment"),n=new o.Attributor.Attribute("id","id",{scope:o.Scope.BLOCK});r.default.register("formats/id",n);var i=n;e.default=i,t.exports=e.default},yvpA:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=(a=s("IUmz"))&&a.__esModule?a:{default:a};const o=r.default.import("blots/block");class n extends o{}n.blotName="firstheader",n.tagName="H1",r.default.register("formats/firstheader",n);var i=n;e.default=i,t.exports=e.default},zp1Z:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=app.state.get(["community"]),e=[],s=app.state.get(["doc","head","contents"]);!s.autotag_league_id&&t.autoTagging.leagueId&&e.push({p:["autotag_league_id"],oi:t.autoTagging.leagueId});!s.autotag_team_id&&t.autoTagging.teamId&&e.push({p:["autotag_team_id"],oi:t.autoTagging.teamId});for(let a of t.autoTagging.autotagTagTypes)s.draft.structured_tags.hasOwnProperty(a)||e.push({p:["draft","structured_tags",a],oi:[]});e.length>0&&a.localUpdate(app.state.get(["doc","id"]),e,-1)};var a=s("dnr0");t.exports=e.default},zvOj:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){app.contentApiSocket.on("stream.story-added",a),app.contentApiSocket.on("stream.story-removed",r),app.once("autosave.error",()=>{app.contentApiSocket.off("stream.story-added",a),app.contentApiSocket.off("stream.story-removed",r)}),o()};var{memberAdded:a,memberRemoved:r,setStreamMembers:o}=s("0PCY");t.exports=e.default}}]);
//# sourceMappingURL=8.ec381af2eb7361d315eb.0.js.map